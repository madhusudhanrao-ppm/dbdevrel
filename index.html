<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevRel Tech Content by Madhusudhan Rao</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #3A3632;
            color: #e0e0e0;
            min-height: 100vh; 
        }
        .navbar {
            background-color: #2C2A26 !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        }
        .navbar.fixed-top { z-index: 1030; } /* ensure navbar is above other content */
        .card {
            background-color: #2C2A26;
            border: 1px solid #404040;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
        }
        .card-title {
            color: #ffffff;
            font-size: 1rem;
        }
        .card-text {
            color: #b0b0b0;
            flex-grow: 1;
            font-size: 0.9rem;
        }
        .card-body {
            display: flex;
            flex-direction: column;
        }
        .btn-primary {
            background-color: #4F693F;
            border-color: #0066cc;
            margin-top: auto;
        }
        .btn-primary:hover {
            background-color: #0052a3;
            border-color: #0052a3;
        }

        .site-padding {
            padding-left: 1rem;
            padding-right: 1rem;
        }
        @media(min-width: 992px) {
            .site-padding { padding-left: 3rem; padding-right: 3rem; }
        }

        .card-img-top {
            height: 220px;
            object-fit: cover;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #e0e0e0;
        }

        /* Section styles */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            margin: 1rem 0 0.5rem;
        }
        .section-header h2 {
            margin: 0;
            font-size: 1.25rem;
            color: #ffffff;
        }
        .section-divider {
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
            margin: .75rem 0 1.5rem;
            border: none;
        }

        /* Collapse toggle styles */
        .section-toggle {
            background: transparent;
            border: none;
            color: #cfcfcf;
            display: inline-flex;
            align-items: center;
            gap: .5rem;
            font-size: 0.95rem;
            padding: .25rem .5rem;
        }
        .section-toggle:focus { outline: none; box-shadow: none; }
        .chev {
            display: inline-block;
            transition: transform .2s ease;
            width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent;
            border-top: 8px solid #cfcfcf;
            transform-origin: center;
        }
        .collapsed .chev { transform: rotate(0deg); }
        .expanded .chev { transform: rotate(180deg); }

        /* navbar search tweaks */
        .nav-search .form-control { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06); color: #e0e0e0; }
        .nav-search .btn { min-width: 66px; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand me-3" href="index.html"><strong>DevRel Technical Content</strong></a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- Single search box (searches both title and text) -->
                <form class="d-flex align-items-center nav-search me-3" id="searchForm" onsubmit="return false;">
                    <input id="searchQuery" class="form-control form-control-sm me-2" type="search" placeholder="Search title & text" aria-label="Search title and text" style="min-width:320px;">
                    <button id="searchBtn" class="btn btn-sm btn-outline-light me-1" type="button">Search</button>
                    <button id="clearSearchBtn" class="btn btn-sm btn-outline-secondary" type="button">Clear</button>
                </form>

                <!-- Sections dropdown -->
                <div class="dropdown me-3">
                    <button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" id="sectionsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        Sections
                    </button>
                    <ul class="dropdown-menu" id="sectionsMenu" aria-labelledby="sectionsDropdown"></ul>
                </div>

                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="index.html">Home</a></li>   
                    <li class="nav-item"><a class="nav-link" href="https://www.oracle.com/in/database/technologies/oracle-database-software-downloads.html" target="_new" style="color: red;">Oracle AI Database</a></li> 
                    <li class="nav-item"><a class="nav-link" href="videos.html" target="_new" style="color: aqua;">Videos</a></li>
                    <li class="nav-item"><a class="nav-link" href="https://github.com/madhusudhanrao-ppm/dbdevrel/discussions/1" target="_new" style="color: aqua;">Discussion</a></li>  
                    <li class="nav-item"><a class="nav-link" href="https://www.linkedin.com/in/madhusudhanraobm/" target="_new" style="color: aqua;">About Madhusudhan Rao</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Content Area -->
    <div class="container-fluid py-5 site-padding">
        <div id="articlesContainer">
            <div class="loading">Loading articles...</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // counter to generate unique IDs for collapsible sections
        let sectionCounter = 0;
        let loadedData = null; // store original articles.json content for filtering

        function createCardHTML(article) {
            const label = article.buttonlabel || 'Read More';
            const image = article.image || 'https://via.placeholder.com/600x400?text=No+Image';
            const tech = article.technologies ? `<br/><br/><b>Technologies: ${article.technologies}</b>` : '';
            return `
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100">
                        <img src="${image}" class="card-img-top" alt="${(article.title||'Article').replace(/"/g,'')}" />
                        <div class="card-body">
                            <h5 class="card-title">${article.title || ''}</h5>
                            <p class="card-text">${article.description || ''}${tech}</p>
                            <a href="${article.url || '#'}" class="btn btn-primary" target="_blank">${label}</a>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderSection(container, title, articles) {
            sectionCounter += 1;
            const collapseId = `collapse-${sectionCounter}`;

            const sectionWrapper = document.createElement('section');
            sectionWrapper.className = 'mb-5';
            sectionWrapper.id = `section-${sectionCounter}`; // anchorable id for dropdown links

            const header = document.createElement('div');
            header.className = 'section-header';
            const h2 = document.createElement('h2');
            h2.textContent = title;
            header.appendChild(h2);

            const isFirst = sectionCounter === 1;
            const toggleBtn = document.createElement('button');
            toggleBtn.className = `section-toggle ${isFirst ? 'expanded' : 'collapsed'}`;
            toggleBtn.setAttribute('type', 'button');
            toggleBtn.setAttribute('data-bs-toggle', 'collapse');
            toggleBtn.setAttribute('data-bs-target', `#${collapseId}`);
            toggleBtn.setAttribute('aria-expanded', isFirst ? 'true' : 'false');
            toggleBtn.setAttribute('aria-controls', collapseId);
            toggleBtn.innerHTML = `<span class="chev"></span><span>${isFirst ? 'Collapse' : 'Expand'}</span>`;

            header.appendChild(toggleBtn);
            sectionWrapper.appendChild(header);

            const divider = document.createElement('hr');
            divider.className = 'section-divider';
            sectionWrapper.appendChild(divider);

            const collapseDiv = document.createElement('div');
            collapseDiv.className = isFirst ? 'collapse show' : 'collapse';
            collapseDiv.id = collapseId;

            const row = document.createElement('div');
            row.className = 'row g-4';

            articles.forEach(article => {
                const temp = document.createElement('div');
                temp.innerHTML = createCardHTML(article);
                row.appendChild(temp.firstElementChild);
            });

            collapseDiv.appendChild(row);
            sectionWrapper.appendChild(collapseDiv);
            container.appendChild(sectionWrapper);

            // update toggle text/icon on collapse events
            collapseDiv.addEventListener('hide.bs.collapse', () => {
                toggleBtn.classList.remove('expanded');
                toggleBtn.classList.add('collapsed');
                toggleBtn.setAttribute('aria-expanded', 'false');
                toggleBtn.querySelector('span:last-child').textContent = 'Expand';
            });
            collapseDiv.addEventListener('show.bs.collapse', () => {
                toggleBtn.classList.remove('collapsed');
                toggleBtn.classList.add('expanded');
                toggleBtn.setAttribute('aria-expanded', 'true');
                toggleBtn.querySelector('span:last-child').textContent = 'Collapse';
            });
        }

        // render data (either {sections:[]} or {articles:[]})
        function renderData(data) {
            sectionCounter = 0;
            const container = document.getElementById('articlesContainer');
            container.innerHTML = '';

            if (!data) {
                container.innerHTML = '<div class="loading">No articles</div>';
                buildSectionsMenu();
                return;
            }

            if (Array.isArray(data.sections) && data.sections.length) {
                data.sections.forEach(sec => {
                    const title = sec.title || 'Untitled Section';
                    const articles = Array.isArray(sec.articles) ? sec.articles : [];
                    if (articles.length) renderSection(container, title, articles);
                });
                if (!container.firstChild) container.innerHTML = '<div class="loading">No matching articles</div>';
                buildSectionsMenu();
                return;
            }

            if (Array.isArray(data.articles)) {
                const grouped = {};
                const order = [];
                data.articles.forEach(a => {
                    const key = a.section || 'General';
                    if (!grouped[key]) grouped[key] = [];
                    grouped[key].push(a);
                    if (!order.includes(key)) order.push(key);
                });
                order.forEach(k => {
                    const articles = grouped[k] || [];
                    if (articles.length) renderSection(container, k, articles);
                });
                if (!container.firstChild) container.innerHTML = '<div class="loading">No matching articles</div>';
                buildSectionsMenu();
                return;
            }

            container.innerHTML = '<div class="loading">No articles found in articles.json</div>';
            buildSectionsMenu();
        }

        // populate the sections dropdown from rendered sections
        function buildSectionsMenu() {
            const menu = document.getElementById('sectionsMenu');
            menu.innerHTML = '';
            const sections = document.querySelectorAll('#articlesContainer section');
            if (!sections.length) {
                const li = document.createElement('li');
                li.innerHTML = '<span class="dropdown-item-text text-muted">No sections</span>';
                menu.appendChild(li);
                return;
            }
            sections.forEach(sec => {
                const titleEl = sec.querySelector('.section-header h2');
                const collapseDiv = sec.querySelector('.collapse');
                const title = titleEl ? titleEl.textContent.trim() : sec.id;
                const sectionId = sec.id;
                const collapseId = collapseDiv ? collapseDiv.id : null;
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.className = 'dropdown-item';
                a.href = `#${sectionId}`;
                a.textContent = title;
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    // collapse other sections
                    document.querySelectorAll('#articlesContainer .collapse.show').forEach(c => {
                        if (c.id !== collapseId) {
                            const inst = bootstrap.Collapse.getOrCreateInstance(c);
                            inst.hide();
                        }
                    });
                    // show target section
                    if (collapseId) {
                        const target = document.getElementById(collapseId);
                        const inst = bootstrap.Collapse.getOrCreateInstance(target);
                        inst.show();
                    }
                    // smooth scroll to the section wrapper
                    document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
                li.appendChild(a);
                menu.appendChild(li);
            });
        }

        function matchesQuery(article, q) {
            if (!q) return true;
            const query = q.toLowerCase();
            const title = (article.title || '').toLowerCase();
            const desc = (article.description || '').toLowerCase();
            const tech = (article.technologies || '').toLowerCase();
            const combined = `${title} ${desc} ${tech}`;
            return title.includes(query) || combined.includes(query);
        }

        function performSearch() {
            if (!loadedData) return;
            const q = document.getElementById('searchQuery').value.trim().toLowerCase();

            if (Array.isArray(loadedData.sections)) {
                const filteredSections = loadedData.sections.map(sec => {
                    const articles = (sec.articles || []).filter(a => matchesQuery(a, q));
                    return { title: sec.title, articles };
                }).filter(s => s.articles.length > 0);
                renderData({ sections: filteredSections });
                return;
            }

            if (Array.isArray(loadedData.articles)) {
                const filtered = loadedData.articles.filter(a => matchesQuery(a, q));
                renderData({ articles: filtered });
                return;
            }
        }

        function clearSearch() {
            document.getElementById('searchQuery').value = '';
            renderData(loadedData);
        }

        async function loadArticles() {
            try {
                const res = await fetch('articles.json');
                if (!res.ok) throw new Error('Failed to load articles.json');
                loadedData = await res.json();
                renderData(loadedData);
            } catch (err) {
                console.error('Error loading articles:', err);
                document.getElementById('articlesContainer').innerHTML =
                    '<div class="loading">Failed to load articles</div>';
                buildSectionsMenu();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadArticles();

            // wire search controls
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('clearSearchBtn').addEventListener('click', clearSearch);
            const input = document.getElementById('searchQuery');
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') performSearch();
            });
        });
        document.addEventListener('DOMContentLoaded', () => { const nav = document.querySelector('nav.navbar'); function updatePadding() { document.body.style.paddingTop = nav ? `${nav.offsetHeight}px` : '0'; } updatePadding(); window.addEventListener('resize', updatePadding); }); 
    </script>
</body>
</html>